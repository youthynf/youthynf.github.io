<!DOCTYPE html><html lang="en-US" mode="light" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="Docker与Kubernetes学习笔记" /><meta name="author" content="ynf" /><meta property="og:locale" content="en_US" /><meta name="description" content="``` 备忘目录： /var/local/k8s 部署相关 /usr/local/data/www-data 共享目录 /usr/local/k8s-install 相关安装包目录" /><meta property="og:description" content="``` 备忘目录： /var/local/k8s 部署相关 /usr/local/data/www-data 共享目录 /usr/local/k8s-install 相关安装包目录" /><link rel="canonical" href="https://youthynf.github.io/posts/Docker%E4%B8%8EKubernetes%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" /><meta property="og:url" content="https://youthynf.github.io/posts/Docker%E4%B8%8EKubernetes%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" /><meta property="og:site_name" content="严能发的博客" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-05-08T15:52:31+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Docker与Kubernetes学习笔记" /><meta name="twitter:site" content="@" /><meta name="twitter:creator" content="@ynf" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"ynf"},"description":"``` 备忘目录： /var/local/k8s 部署相关 /usr/local/data/www-data 共享目录 /usr/local/k8s-install 相关安装包目录","url":"https://youthynf.github.io/posts/Docker%E4%B8%8EKubernetes%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/","@type":"BlogPosting","headline":"Docker与Kubernetes学习笔记","dateModified":"2021-11-08T23:20:18+08:00","datePublished":"2021-05-08T15:52:31+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://youthynf.github.io/posts/Docker%E4%B8%8EKubernetes%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"},"@context":"https://schema.org"}</script><title>Docker与Kubernetes学习笔记 | 严能发的博客</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script> <script> var _hmt = _hmt || []; (function() { var hm = document.createElement("script"); hm.src = "https://hm.baidu.com/hm.js?4dff01b016fbd71615a3abf5d9c1f1be"; var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s); })(); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://avatars.githubusercontent.com/u/20438133?v=4" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">严能发的博客</a></div><div class="site-subtitle font-italic">遥远的目标经不起执着的追求。</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>首页</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>分类</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>标签</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>日志</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>关于</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/youthynf" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['yannengfa','126.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Docker与Kubernetes学习笔记</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="搜索..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Docker与Kubernetes学习笔记</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> ynf </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sat, May 8, 2021, 3:52 PM +0800" prep="on" > May 8 <i class="unloaded">2021-05-08T15:52:31+08:00</i> </span></div><div> <span> <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Mon, Nov 8, 2021, 11:20 PM +0800" prefix="Updated " > Nov 8 <i class="unloaded">2021-11-08T23:20:18+08:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2990 words">16 min</span></div></div><div class="post-content"><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>备忘目录：
/var/local/k8s 部署相关
/usr/local/data/www-data 共享目录
/usr/local/k8s-install 相关安装包目录

运行环境：
VMware下的3台Centos7虚拟机：
master：192.168.93.129
node1：192.168.93.130
node2：192.168.93.131
</pre></table></code></div></div><h2 id="docker入门笔记">Docker入门笔记</h2><h3 id="1前置准备"><strong>1、前置准备：</strong><br /></h3><p>配置yum源工具：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>yum install -y yum-utils device-mapper-persistent-data lvm2
</pre></table></code></div></div><p>配置阿里的安装源</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
</pre></table></code></div></div><p>判断哪个安装源最快：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>yum makecache fast
</pre></table></code></div></div><h3 id="2安装docker的社区版本"><strong>2、安装docker的社区版本：</strong><br /></h3><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>yum -y install docker-ce
</pre></table></code></div></div><p>启动docker：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>service docker start
</pre></table></code></div></div><p>验证：可以看到客服端和服务器端都已经安装好了</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>docker version
</pre></table></code></div></div><h3 id="3尝试拉取hello-world镜像"><strong>3、尝试拉取hello world镜像:</strong></h3><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>docker pull 镜像名
</pre></table></code></div></div><h3 id="4使用阿里云的docker加速代理"><strong>4、使用阿里云的docker加速代理<br /></strong></h3><p>阿里云上搜“镜像加速器” 针对Docker客户端版本大于 1.10.0 的用户 您可以通过修改daemon配置文件/etc/docker/daemon.json来使用加速器</p><h3 id="5容器相关操作"><strong>5、容器相关操作</strong></h3><p>创建容器</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>docker run 镜像名 //前台运行
docker run -d 镜像名 //后台运行
docker run -d -p 8000:8080 镜像名 //后台运行并进行端口映射，其中8000是宿主机开放端口，8080是容器端口
</pre></table></code></div></div><p>查看运行中的容器：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>docker ps
</pre></table></code></div></div><p>停止运行中的容器：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>docker stop 容器名
</pre></table></code></div></div><p>删除容器：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>docker rm 容器id
</pre></table></code></div></div><p>删除镜像：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>docker rmi 镜像id
</pre></table></code></div></div><p>进入运行中的容器内：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>docker exec -it 容器id /bin/bash
</pre></table></code></div></div><h3 id="6容器间通信"><strong>6、容器间通信</strong><br /></h3><p>容器间单向通信：前提是运行是每个容器都需要有个name</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>docker run -d --name 容器名A tomcat
docker run -d --name 容器名B --link 自定义容器名A tomcat
</pre></table></code></div></div><p>此时实现效果是，进入容器B可以“ping 容器A”，但反之不行</p><p>容器双向通信：通过桥接的方式<br /> 容器通过网桥和宿主机的网卡建立通信，并由宿主机网卡转发，实现容器与外部网络互通。同一个网桥下的容器可以实现互联互通。<br /> 创建docker自定义网桥，底层是通过虚拟网卡实现</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>docker network create -d bridge 网桥名
//查看docker底层网络
docker network ls
//绑定
docker network connect 网桥名 容器名A
docker network connect 网桥名 容器名B
</pre></table></code></div></div><p>此时容器A和容器B都能互相通信了</p><h3 id="7共享目录"><strong>7、共享目录</strong><br /></h3><p>使用-v创建共享volume</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>docker run --name 容器名 -v 宿主机要共享目录绝对路径:容器生效的目录绝对路径 镜像名称
使用共享容器
docker create --name 共享容器名 -v 宿主机要共享目录绝对路径:容器生效的目录绝对路径 镜像名 /bin/true
docker run -p 8002:8080 --volumes-from 共享容器名 --name 容器名 -d 镜像名
</pre></table></code></div></div><h3 id="8容器编排工具docker-compose"><strong>8、容器编排工具docker compose</strong><br /></h3><p>安装：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>sudo curl -L "https://github.com/docker/compose/releases/download/1.29.1/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
修改目录权限：
sudo chmod +x /usr/local/bin/docker-compose
查看docker-compose版本：
docker-compose --version
</pre></table></code></div></div><h3 id="示例使用docker-compose快速安装wordpress开源博客后台"><strong>示例</strong>：使用docker-compose快速安装WordPress开源博客后台</h3><p>首先创建一个项目目录</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>mkdir wordpress
</pre></table></code></div></div><p>在目录下创建docker-compose.yml配置文件，内容：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre><td class="rouge-code"><pre>version: "3.9"
    
services:
  db:
    image: mysql:5.7
    volumes:
      - db_data:/var/lib/mysql
    restart: always
    environment:
      MYSQL_ROOT_PASSWORD: somewordpress
      MYSQL_DATABASE: wordpress
      MYSQL_USER: wordpress
      MYSQL_PASSWORD: wordpress
    
  wordpress:
    depends_on:
      - db
    image: wordpress:latest
    ports:
      - "8000:80"
    restart: always
    environment:
      WORDPRESS_DB_HOST: db:3306
      WORDPRESS_DB_USER: wordpress
      WORDPRESS_DB_PASSWORD: wordpress
      WORDPRESS_DB_NAME: wordpress
volumes:
  db_data: {}  
</pre></table></code></div></div><p>启动部署安装过程：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>docker-compose up -d
</pre></table></code></div></div><h3 id="9实战应用"><strong>9、实战应用</strong><br /></h3><p>创建dockeefile文件：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>FROM openjdk:8u222-jre
WORKDIR /usr/local/bsbdj
ADD bsbdj.jar .
ADD application.yml .
ADD application-dev.yml .
EXPOSE 80
CMD ["java","-jar","bsbdj.jar"]
</pre></table></code></div></div><p>构造镜像：在dockerfile对应文件目录中执行</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>docker build -t mashibing.com/bsbdj-app .
</pre></table></code></div></div><p>创建并启动容器：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>docker run mashibing.com/bsbdj-app
</pre></table></code></div></div><p>创建数据库Dockerfile文件</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>FROM mysql:5.7
WORKDIR /docker-entrypoint-initdb.d
ADD init-db.sql .
</pre></table></code></div></div><p>通过Dockerfile构造镜像：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>docker build -t mashibing.com/bsbdj-db .
</pre></table></code></div></div><p>创建数据库容器并制定root账号密码：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>docker run -d -e MYSQL_ROOT_PASSWORD=root  mashibing.com/bsbdj-db
</pre></table></code></div></div><h3 id="10使用docker-compose编排容器"><strong>10、使用docker-compose编排容器：</strong></h3><p>编辑docker-compose.yml文件：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre>version: '3.3'
services:
  db:
    build: ./bsbdj-db/
    restart: always
    environment:
      MYSQL_ROOT_PASSWORD: root
  app:
    build: ./bsbdj-app/
    depends_on:
      - db
    ports:
      - "80:80"
    restart: always
</pre></table></code></div></div><p>其中：<br /> db表示容器名和服务名；<br /> build表示对指定目录下的Dockerfile文件进行解析和创建对应的容器；<br /> restart表示异常退出后执行重启；<br /> environment表示启动容器时通过-e添加的附加环境变量；<br /> depends_on表示依赖的服务，指向具体的服务名称，可以实现容器见的互联互通；<br /> ports表示端口映射；<br /> 执行compose：在docker-compose.yml的目录中直接执行即可</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>docker-compose up
</pre></table></code></div></div><p>后台运行：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>docker-compose up -d
</pre></table></code></div></div><p>查看后台日志</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>docker-compose logs
docker-compose logs db
</pre></table></code></div></div><p>关掉应用：stop-&gt;rm</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>docker-compose down
</pre></table></code></div></div><h2 id="kubernetes">Kubernetes</h2><h3 id="前置准备"><strong>前置准备</strong><br /></h3><h3 id="1-设置主机名与时区"><strong>1. 设置主机名与时区</strong><br /></h3><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>timedatectl set-timezone Asia/Shanghai  #都要执行
hostnamectl set-hostname master   #132执行
hostnamectl set-hostname node1    #133执行
hostnamectl set-hostname node2    #137执行
</pre></table></code></div></div><h3 id="2-关闭防火墙三台虚拟机都要设置生产环境跳过这一步"><strong>2. 关闭防火墙，三台虚拟机都要设置，生产环境跳过这一步</strong></h3><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>sed -i 's/SELINUX=enforcing/SELINUX=disabled/g' /etc/selinux/config
setenforce 0
systemctl disable firewalld
systemctl stop firewalld
</pre></table></code></div></div><h3 id="3安装具体步骤"><strong>3、安装具体步骤</strong></h3><p>将镜像包上传至服务器每个节点：网络原因改用离线安装略</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>mkdir /usr/local/k8s-install
cd /usr/local/k8s-install
#XFTP上传安装文件
</pre></table></code></div></div><p>按每个Centos上安装Docker</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>tar -zxvf docker-ce-18.09.tar.gz
cd docker 
yum localinstall -y *.rpm
systemctl start docker
systemctl enable docker
</pre></table></code></div></div><p>确保从cgroups均在同一个从groupfs</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>#cgroups是control groups的简称，它为Linux内核提供了一种任务聚集和划分的机制，通过一组参数集合将一些任务组织成一个或多个子系统。   
#cgroups是实现IaaS虚拟化(kvm、lxc等)，PaaS容器沙箱(Docker等)的资源管理控制部分的底层基础。
#子系统是根据cgroup对任务的划分功能将任务按照一种指定的属性划分成的一个组，主要用来实现资源的控制。
#在cgroup中，划分成的任务组以层次结构的形式组织，多个子系统形成一个数据结构中类似多根树的结构。cgroup包含了多个孤立的子系统，每一个子系统代表单一的资源
docker info | grep cgroup 
</pre></table></code></div></div><p>如果不是groupfs,执行下列语句</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>cat &lt;&lt; EOF &gt; /etc/docker/daemon.json
{
  "exec-opts": ["native.cgroupdriver=cgroupfs"]
}
EOF
systemctl daemon-reload &amp;&amp; systemctl restart docker
</pre></table></code></div></div><p>安装kubeadm</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre># kubeadm是集群部署工具
cd /usr/local/k8s-install/kubernetes-1.14
tar -zxvf kube114-rpm.tar.gz
cd kube114-rpm
yum localinstall -y *.rpm
</pre></table></code></div></div><p>关闭交换区</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>swapoff -a
vi /etc/fstab 
#swap一行注释
</pre></table></code></div></div><p>配置网桥</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>cat &lt;&lt;EOF &gt;  /etc/sysctl.d/k8s.conf
net.bridge.bridge-nf-call-ip6tables = 1
net.bridge.bridge-nf-call-iptables = 1
EOF
sysctl --system
</pre></table></code></div></div><p>通过镜像安装k8s</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>cd /usr/local/k8s-install/kubernetes-1.14
docker load -i k8s-114-images.tar.gz
docker load -i flannel-dashboard.tar.gz
</pre></table></code></div></div><p><strong>以上配置每个节点都需要配置安装！！！！</strong></p><h3 id="4配置k8s"><strong>4、配置k8s:<br /></strong></h3><p>master主服务器配置</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>kubeadm init --kubernetes-version=v1.14.1 --pod-network-cidr=10.244.0.0/16

mkdir -p $HOME/.kube
sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
sudo chown $(id -u):$(id -g) $HOME/.kube/config

kubectl get nodes
#查看存在问题的pod
kubectl get pod --all-namespaces
#设置全局变量
#安装flannel网络组件：解决padding非running状态问题
kubectl create -f kube-flannel.yml
</pre></table></code></div></div><h3 id="5加入node节点"><strong>5、加入NODE节点</strong></h3><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>kubeadm join 192.168.4.130:6443 --token 911xit.xkp2gfxbvf5wuqz7 \
    --discovery-token-ca-cert-hash sha256:23db3094dc9ae1335b25692717c40e24b1041975f6a43da9f43568f8d0dbac72
</pre></table></code></div></div><p>如果忘记，在master 上执行kubeadm token list 查看 ，在node上运行：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>kubeadm join 192.168.163.132:6443 --token aoeout.9k0ybvrfy09q1jf6 --discovery-token-unsafe-skip-ca-verification
kubectl get nodes
</pre></table></code></div></div><h3 id="6master开启仪表盘"><strong>6、Master开启仪表盘</strong></h3><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>kubectl apply -f kubernetes-dashboard.yaml
kubectl apply -f admin-role.yaml
kubectl apply -f kubernetes-dashboard-admin.rbac.yaml
kubectl -n kube-system get svc
http://192.168.163.132:32000 访问
</pre></table></code></div></div><h3 id="7启动k8s服务"><strong>7、启动k8s服务</strong></h3><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>service kubelet start
</pre></table></code></div></div><p>区分：kubelet、kubectl、kubeadm</p><h3 id="8部署tomcat集群deployment部署"><strong>8、部署tomcat集群：Deployment（部署）</strong></h3><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>kubectl create -f 部署yml文件 
</pre></table></code></div></div><p>yml模板：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre><td class="rouge-code"><pre>apiVersion: extensions/v1beta1
kind: Deployment
metadata: 
  name: tomcat-deploy
spec:
  replicas: 2 
  template: 
    metadata:
      labels:
        app: tomcat-cluster
    spec:
      volumes: 
      - name: web-app
        hostPath:
          path: /mnt/webapps
      containers:
      - name: tomcat-cluster
        image: tomcat:latest
        resources:
          requests:
            cpu: 0.5
            memory: 200Mi
          limits:
            cpu: 1
            memory: 512Mi
        ports:
        - containerPort: 8080
        volumeMounts:
        - name: web-app
          mountPath: /usr/local/tomcat/webapps
</pre></table></code></div></div><h3 id="9部署常用命令"><strong>9、部署常用命令</strong></h3><p>创建部署：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>kubectl create -f 部署yml文件
</pre></table></code></div></div><p>更新部署配置：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>kubectl apply -f 部署yml文件
</pre></table></code></div></div><p>查看已部署pod：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>kubectl get pod [-o wide]
</pre></table></code></div></div><p>查看pod详细信息:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>kubectl describe pod pod名称
</pre></table></code></div></div><p>查看pod输出日志：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>kubectl logs [-f] pod名称
</pre></table></code></div></div><p>查看部署情况：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>kubectl get deployment
</pre></table></code></div></div><p>删除部署：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>kubectl delete deployment 部署名
</pre></table></code></div></div><h3 id="10外部访问tomcat集群"><strong>10、外部访问Tomcat集群：</strong><br /></h3><p><strong>（1）nodeport方式</strong><br /> 编写service的yml文件：如tomcat-service.yml</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre>apiVersion: v1
kind: Service
metadata:
  name: tomcat-service
  labels:
    app: tomcat-service
spec:
  type: NodePort
  selector:
    app: tomcat-cluster
  ports:
  - port: 8000
    targetPort: 8080
    nodePort: 32500
</pre></table></code></div></div><p>创建并启动服务</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>kubectl create -f ./tomcat-service.yml
</pre></table></code></div></div><p>查询状态：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>kubectl get service
</pre></table></code></div></div><p>删除：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>kubectl delete service 服务名
</pre></table></code></div></div><p><strong>（2）利用Rinted端口转发工具实现Service负载均衡</strong><br /> 修改tomcat-service.yml文件：仅仅注释两行代码</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre>apiVersion: v1
kind: Service
metadata:
  name: tomcat-service
  labels:
    app: tomcat-service
spec:
#  type: NodePort
  selector:
    app: tomcat-cluster
  ports:
  - port: 8000
    targetPort: 8080
#    nodePort: 32500
</pre></table></code></div></div><p>创建service：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>kubectl create -f tomcat-service.yml
</pre></table></code></div></div><p>检查service：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>kubectl get service
</pre></table></code></div></div><p>安装rinetd</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>cd /usr/local   
wget http://www.boutell.com/rinetd/http/rinetd.tar.gz
sed -i 's/65536/65535/g' rinetd.c 
mkdir -p /usr/man/
yum install -y gcc
make &amp;&amp; make install
</pre></table></code></div></div><p>此时会报错： 解决：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>vi /etc/rinetd.conf：
0.0.0.0 8080 192.168.92.9 8080
</pre></table></code></div></div><p>进行加载：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>rinetd -c /etc/rinetd.conf
</pre></table></code></div></div><h3 id="11节点文件共享"><strong>11、节点文件共享</strong></h3><p><strong>（1）Server节点：</strong><br /> 文件共享NFS：主要采用远程过程调用RPC机制实现文件传输</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>yum install -y nfs-utils rpcbind
</pre></table></code></div></div><p>创建共享目录www-data并编辑共享文件夹配置：<br /> vim /etc/exports，配置内容是：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>/usr/local/data/www-data 192.168.163.132/24(rw,sync)
</pre></table></code></div></div><p>开启nfs服务：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>service nfs start
</pre></table></code></div></div><p>开启rpcbind服务：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>service rcbind start
</pre></table></code></div></div><p>设置开机启动：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>systemctl enable nfs.service
systemctl enable rpcbind.service
</pre></table></code></div></div><p>检查：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>exportfs
</pre></table></code></div></div><p><strong>（2）node节点服务器：</strong><br /> 只需要安装nfs：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>yum install -y nfs-utils
</pre></table></code></div></div><p>查看远程共享文件夹：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>showmount -e 192.168.93.129
</pre></table></code></div></div><p>挂载</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>mount 192.168.93.129:/usr/local/data/www-data /mnt
</pre></table></code></div></div><p>最开始的配置已经完成挂载部署。</p><p>查看部署点：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>kubectl get pod -o wide
</pre></table></code></div></div><p>直接在master上进入对应的部署节点：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>kubectl exec -it pod名称 /bin/bash
</pre></table></code></div></div><h3 id="12集群配置调整"><strong>12、集群配置调整</strong></h3><p>更新集群配置：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>kubectl apply -f yml文件路径
</pre></table></code></div></div><p>删除部署、服务：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>kubectl delete deployment 部署名
kubectl delete service 服务名
</pre></table></code></div></div><h3 id="13实例实战"><strong>13、实例实战</strong></h3><p>项目基本目录：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>|--demo
    |--dist
        application.yml
        demo.jar
    |--sql
        demo.sql
    demo-app-deploy.yml
    demo-app-service.yml
    demo-db-deploy.yml
    demo-db-service.yml
</pre></table></code></div></div><p>yml配置文件：<br /> demo-app-deploy.yml</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre>apiVersion: apps/v1beta1
kind: Deployment
metadata:
  name: demo-app-deploy
spec:
  replicas: 2
  template:
    metadata:
      labels:
        app: demo-app-deploy
    spec:
      volumes:
      - name : demo-app-volume
        hostPath:
          path: /usr/local/demo-dist
      containers:
      - name: demo-app-deploy
        image: openjdk:8u222-jre
        command: ["/bin/sh"]
        args: ["-c","cd /usr/local/demo-dist;java -jar demo.jar"]
        volumeMounts:
        - name: demo-app-volume
          mountPath: /usr/local/demo-dist
</pre></table></code></div></div><p>demo-app-service.yml</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>apiVersion: v1
kind: Service
metadata:
  name: demo-app-service
  labels: 
    app: demo-app-service
spec:
  selector:
    app: demo-app-deploy
  ports:
  - port: 80
    targetPort: 80
</pre></table></code></div></div><p>demo-db-deploy.yml</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre>apiVersion: apps/v1beta1
kind: Deployment
metadata:
  name: demo-db-deploy
spec:
  replicas: 1
  template:
    metadata:
      labels:
        app: demo-db-deploy
    spec:
      volumes:
      - name: demo-db-volume
        hostPath:
          path: /usr/local/demo-sql
      containers:
      - name: demo-db-deploy
        image: mysql:5.7
        ports: 
        - containerPort: 3306
        env:
        - name: MYSQL_ROOT_PASSWORD
          value: "root"
        volumeMounts:
        - name: demo-db-volume
          mountPath: /docker-entrypoint-initdb.d
</pre></table></code></div></div><p>demo-db-service.yml</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>apiVersion: v1
kind: Service
metadata:
  name: demo-db-service
  labels: 
    app: demo-db-service
spec:
  selector:
    app: demo-db-deploy
  ports:
  - port: 3310
    targetPort: 3306
</pre></table></code></div></div><p>application.yml</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre>server:
  port: 80
spring:
  datasource:
    driver-class-name: com.mysql.jdbc.Driver
    url: jdbc:mysql://demo-db-service:3310/demo?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false
    username: root
    password: root
  mvc:
    favicon:
      enabled: false
mybatis:
  mapper-locations: classpath:/mapper/*.xml
  configuration:
    map-underscore-to-camel-case: true
</pre></table></code></div></div><p>k8s常用指令：</p><p>获取服务列表：kubectl get service</p><p>获取部署列表：kubectl get deployment</p><p>获取服务的详细信息：kubectl describe service eureka-consumer-service</p><p>获取部署的详细信息：kubectl describe deployment eureka-server-deploy</p><p>获取pod容器列表：kubectl get pod</p><p>获取pod容器列表及详细信息：kubectl get pod -o wide</p><p>获取指定pod的详细信息：kubectl describe pod eureka-consumer-deploy-84dfc8d88f-7qrgj</p><p>获取pod的日志信息：kubectl logs -f eureka-consumer-deploy-84dfc8d88f-7qrgj</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/%E8%BF%90%E7%BB%B4%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96/'>运维与自动化</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/kubernetes/" class="post-tag no-text-decoration" >Kubernetes</a> <a href="/tags/docker/" class="post-tag no-text-decoration" >Docker</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Docker与Kubernetes学习笔记 - 严能发的博客&url=https://youthynf.github.io/posts/Docker%E4%B8%8EKubernetes%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Docker与Kubernetes学习笔记 - 严能发的博客&u=https://youthynf.github.io/posts/Docker%E4%B8%8EKubernetes%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Docker与Kubernetes学习笔记 - 严能发的博客&url=https://youthynf.github.io/posts/Docker%E4%B8%8EKubernetes%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>最近更新</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Linux%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/">Linux系统的内存管理</a><li><a href="/posts/%E9%99%90%E6%B5%81%E7%9A%84%E7%90%86%E8%A7%A3/">你对限流了解多少</a><li><a href="/posts/SSM%E6%A1%86%E6%9E%B6%E6%95%B4%E5%90%88/">SSM框架整合</a><li><a href="/posts/JavaWeb%E6%A8%A1%E6%9D%BF/">Java Web开发模板</a><li><a href="/posts/SpringMVC%E8%AF%A6%E8%A7%A3/">SpringMVC详解</a></ul></div><div id="access-tags"> <span>文章标签</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/java/">JAVA</a> <a class="post-tag" href="/tags/mybatis/">MyBatis</a> <a class="post-tag" href="/tags/php/">PHP</a> <a class="post-tag" href="/tags/spring/">Spring</a> <a class="post-tag" href="/tags/springmvc/">SpringMVC</a> <a class="post-tag" href="/tags/docker/">Docker</a> <a class="post-tag" href="/tags/el%E8%A1%A8%E8%BE%BE%E5%BC%8F/">EL表达式</a> <a class="post-tag" href="/tags/exception/">Exception</a> <a class="post-tag" href="/tags/jekyll/">Jekyll</a> <a class="post-tag" href="/tags/kafka/">KAFKA</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>更多文章</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Linux%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/"><div class="card-body"> <span class="timeago small" > Nov 9 <i class="unloaded">2021-11-09T06:36:31+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Linux系统的内存管理</h3><div class="text-muted small"><p> 内存管理的发展过程 DOS操作系统时代 磁盘操作系统（Disk Operating System），是早期个人计算机上的一类操作系统。DOS在IBM PC 兼容机市场中占有举足轻重的地位。可以直接操纵管理硬盘的文件，以DOS的形式运行。微软图形界面操作系统Windows NT问世以来，DOS是一个后台程序的形式出现的。名为Windows命令提示符。可以通过点击运行-CMD进入。 特点：...</p></div></div></a></div><div class="card"> <a href="/posts/JavaWeb%E6%A8%A1%E6%9D%BF/"><div class="card-body"> <span class="timeago small" > Oct 25 <i class="unloaded">2021-10-25T23:10:31+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Java Web开发模板</h3><div class="text-muted small"><p> Java Web开发模板 1、Servlet项目web.xml模板： 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 &lt;?xml version="1.0" encoding="UTF-8" ?&gt; &lt;web-app xmlns="http://xmlns.jcp.org/xml/ns/javaee" ...</p></div></div></a></div><div class="card"> <a href="/posts/%E5%85%AB%E5%A4%A7%E5%9F%BA%E6%9C%AC%E6%8E%92%E5%BA%8F%E7%9A%84Java%E5%92%8CPHP%E5%AE%9E%E7%8E%B0/"><div class="card-body"> <span class="timeago small" > Jul 2 <i class="unloaded">2021-07-02T18:47:31+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>常用的基本排序的Java和PHP实现</h3><div class="text-muted small"><p> 常用的基本排序的Java和PHP实现</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/MySQL%E5%A4%87%E5%BF%98%E7%AC%94%E8%AE%B0/" class="btn btn-outline-primary" prompt="上一篇"><p>MySQL备忘笔记</p></a> <a href="/posts/%E4%B8%AD%E9%97%B4%E4%BB%B6%E4%B9%8BKAFKA/" class="btn btn-outline-primary" prompt="下一篇"><p>中间件学习之KAFKA</p></a></div><div id="disqus" class="pt-2 pb-2"><p class="text-center text-muted small pb-5"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script src="/assets/js/lib/jquery.disqusloader.min.js"></script> <script> const options = { scriptUrl: '//ynf.disqus.com/embed.js', disqusConfig: function() { this.page.title = 'Docker与Kubernetes学习笔记'; this.page.url = 'https://youthynf.github.io/posts/Docker%E4%B8%8EKubernetes%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/'; this.page.identifier = '/posts/Docker%E4%B8%8EKubernetes%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/'; } }; $.disqusLoader('#disqus', options); </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://github.com/youthynf">ynf</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">文章标签</h4><a class="post-tag" href="/tags/java/">JAVA</a> <a class="post-tag" href="/tags/mybatis/">MyBatis</a> <a class="post-tag" href="/tags/php/">PHP</a> <a class="post-tag" href="/tags/spring/">Spring</a> <a class="post-tag" href="/tags/springmvc/">SpringMVC</a> <a class="post-tag" href="/tags/docker/">Docker</a> <a class="post-tag" href="/tags/el%E8%A1%A8%E8%BE%BE%E5%BC%8F/">EL表达式</a> <a class="post-tag" href="/tags/exception/">Exception</a> <a class="post-tag" href="/tags/jekyll/">Jekyll</a> <a class="post-tag" href="/tags/kafka/">KAFKA</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://youthynf.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
